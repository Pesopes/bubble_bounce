(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();const ae="/bubble_bounce/assets/1-msowq8PV.png",ue="/bubble_bounce/assets/10-C2b_EmXV.png",he="/bubble_bounce/assets/11-RrZkbv2B.png",ce="/bubble_bounce/assets/12-Cj-w1vrm.png",de="/bubble_bounce/assets/16-CIkSIS7u.png",be="/bubble_bounce/assets/17-CCe0iIc4.png",pe="/bubble_bounce/assets/18-wsb_O-g9.png",fe="/bubble_bounce/assets/19-B4aX6oMj.png",ge="/bubble_bounce/assets/2-CZcekOIb.png",me="/bubble_bounce/assets/20-CBLc80yN.png",_e="/bubble_bounce/assets/21-B6YSg9Ux.png",ye="/bubble_bounce/assets/22-Bey-tXPl.png",we="/bubble_bounce/assets/23-CfGDoL72.png",ve="/bubble_bounce/assets/24-BHXDI67n.png",Be="/bubble_bounce/assets/25-D-lPi3tR.png",xe="/bubble_bounce/assets/26-qODNZ1eh.png",Ce="/bubble_bounce/assets/27-CLKhPhSb.png",Me="/bubble_bounce/assets/28-CYOAUwfl.png",Se="/bubble_bounce/assets/29-D7x_Qp9C.png",De="/bubble_bounce/assets/3-_feIaOhr.png",Pe="/bubble_bounce/assets/30-CaNdivBa.png",Ie="/bubble_bounce/assets/31-B-NKGiGE.png",Oe="/bubble_bounce/assets/32-8ghHFANu.png",Ee="/bubble_bounce/assets/4-DD3Yexrc.png",Te="/bubble_bounce/assets/5-Btr9iXW_.png",Re="/bubble_bounce/assets/6-BGMDbjSf.png",ze="/bubble_bounce/assets/7-CMnHBFWr.png",Le="/bubble_bounce/assets/8-kXJG1xv3.png",qe=0,Z=.992,$e=.96;class i{x;y;constructor(e=0,s=0){this.x=e,this.y=s}squared(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){var e=this.length();return e>0?this.div(e):new i(this.x,this.y)}div(e){return e instanceof i?new i(this.x/e.x,this.y/e.y):new i(this.x/e,this.y/e)}mult(e){return e instanceof i?new i(this.x*e.x,this.y*e.y):new i(this.x*e,this.y*e)}add(e){return e instanceof i?new i(this.x+e.x,this.y+e.y):new i(this.x+e,this.y+e)}sub(e){return e instanceof i?new i(this.x-e.x,this.y-e.y):new i(this.x-e,this.y-e)}negate(){return new i(-this.x,-this.y)}dot(e){return this.x*e.x+this.y*e.y}static lerp(e,s,o){return e.add(s.sub(e).mult(o))}}class R{pos;dim;borderRadius;constructor(e,s,o=1){this.pos=e,this.dim=s,this.borderRadius=o}getCenter(){return this.pos.add(this.dim.div(2))}render(e){e.fillStyle="F0EBE3",te(e,Math.floor(this.pos.x),Math.floor(this.pos.y),this.dim.x,this.dim.y,this.borderRadius+15)}}class I{pos;dim;onClick;text;color;borderRadius;constructor(e,s,o,n,l="red",a=55){this.pos=e,this.dim=s,this.text=o,this.onClick=n,this.color=l,this.borderRadius=a}getCenter(){return this.pos.add(this.dim.div(2))}isInside(e){return e.x>=this.pos.x&&e.x<=this.pos.x+this.dim.x&&e.y>=this.pos.y&&e.y<=this.pos.y+this.dim.y}checkClick(e=mousePos){this.isInside(e)&&this.onClick(this)}render(e){e.fillStyle=this.color,te(e,Math.floor(this.pos.x),Math.floor(this.pos.y),this.dim.x,this.dim.y,this.borderRadius),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.font=`${Math.floor(this.dim.y/3)}px "verdana", sans-serif`,e.measureText(this.text);const s=this.getCenter();e.fillText(this.text,s.x,s.y,this.dim.x)}}class q{pos;radius;velocity;sprite;rotSpeed;rot;player;bouncedOffWall;constructor(e,s,o,n,l=0){this.pos=e,this.radius=s,this.velocity=o,this.sprite=n,this.rotSpeed=0,this.player=l}mass(){return Math.PI*this.radius*this.radius/100}kineticEnergy(){return this.mass()/2*this.velocity.squared()}outOfBounds(e,s){const o=this.radius+this.radius/3;return this.pos.x-this.radius+o<=0||this.pos.x+this.radius-o>=e||this.pos.y-this.radius+o<=0||this.pos.y+this.radius-o>=s}isCollidingBubble(e){const s=this.pos.sub(e.pos),o=this.radius+e.radius;return s.length()<=o}isCollidingBlock(e){const s=e.borderRadius;let o=!1;const n=Math.max(e.pos.x+s,Math.min(this.pos.x,e.pos.x+e.dim.x-s)),l=Math.max(e.pos.y+s,Math.min(this.pos.y,e.pos.y+e.dim.y-s)),a=new i(n,l),h=this.pos.sub(a).length();h<=this.radius&&(o=!0,n===e.pos.x+s||n===e.pos.x+e.dim.x-s||l===e.pos.y+s||e.pos.y+e.dim.y-s,this.radius-h);const b=[new i(e.pos.x+s,e.pos.y+s),new i(e.pos.x+e.dim.x-s,e.pos.y+s),new i(e.pos.x+s,e.pos.y+e.dim.y-s),new i(e.pos.x+e.dim.x-s,e.pos.y+e.dim.y-s)];for(const c of b){const p=this.pos.sub(c).length();if(p<=this.radius+s){o=!0,this.pos.sub(c).normalize(),this.radius+s-p;break}}return o}collideBlock(e){const s=e.borderRadius;let o=!1,n=new i(0,0),l=0;const a=Math.max(e.pos.x+s,Math.min(this.pos.x,e.pos.x+e.dim.x-s)),h=Math.max(e.pos.y+s,Math.min(this.pos.y,e.pos.y+e.dim.y-s)),b=new i(a,h),c=this.pos.sub(b).length();c<=this.radius&&(o=!0,a===e.pos.x+s?n=new i(-1,0):a===e.pos.x+e.dim.x-s?n=new i(1,0):h===e.pos.y+s?n=new i(0,-1):h===e.pos.y+e.dim.y-s&&(n=new i(0,1)),l=this.radius-c);const p=[new i(e.pos.x+s,e.pos.y+s),new i(e.pos.x+e.dim.x-s,e.pos.y+s),new i(e.pos.x+s,e.pos.y+e.dim.y-s),new i(e.pos.x+e.dim.x-s,e.pos.y+e.dim.y-s)];for(const u of p){const x=this.pos.sub(u).length();if(x<=this.radius+s){o=!0,n=this.pos.sub(u).normalize(),l=this.radius+s-x;break}}if(o){this.pos=this.pos.add(n.mult(l));const u=this.velocity.dot(n);this.velocity=this.velocity.sub(n.mult(2*u)),this.velocity=this.velocity.mult($e),this.bouncedOffWall=!0}}collideBubble(e){const s=this.pos.sub(e.pos),o=this.radius+e.radius,n=s.length();if(n<=o){const l=s.normalize(),a=this.velocity.sub(e.velocity),h=l.mult(2*a.dot(l)/(this.mass()+e.mass()));this.velocity=this.velocity.sub(h.mult(e.mass())),e.velocity=e.velocity.add(h.mult(this.mass()));const b=o-n,c=l.mult(b/2);this.pos=this.pos.add(c),e.pos=e.pos.sub(c);const p=h.normalize().dot(new i(-this.velocity.y,this.velocity.x).normalize());this.rotSpeed=p/100,e.rotSpeed=p/100}}update(){this.velocity.y+=qe*this.mass(),this.velocity=this.velocity.mult(Z),this.rotSpeed*=Z,this.rot+=this.rotSpeed,this.pos=this.pos.add(this.velocity)}render(e){this.rot=this.rot||Math.PI*2*Math.random(),je(e,this.sprite,this.pos,this.radius*2,this.rot)}simpleRender(e){e.fillStyle=color,H(e,this.pos,this.radius)}isInside(e){return e.sub(this.pos).length()<=this.radius}}function je(t,e,s,o,n){t.save(),t.translate(Math.floor(s.x),Math.floor(s.y)),t.rotate(n),t.drawImage(e,-o/2,-o/2,o,o),t.restore()}function H(t,e,s){t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),s,0,Math.PI*2),t.fill()}function te(t,e,s,o,n,l){t.strokeStyle="rgba(0, 0, 0, 1.0)",t.lineWidth=6,t.beginPath(),t.moveTo(e+l,s),t.lineTo(e+o-l,s),t.arcTo(e+o,s,e+o,s+l,l),t.lineTo(e+o,s+n-l),t.arcTo(e+o,s+n,e+o-l,s+n,l),t.lineTo(e+l,s+n),t.arcTo(e,s+n,e,s+n-l,l),t.lineTo(e,s+l),t.arcTo(e,s,e+l,s,l),t.stroke(),t.fill()}const Ae="/bubble_bounce/assets/abstract_dots-DTrwscDn.svg",Ne=Object.assign({"./assets/balls/1.png":ae,"./assets/balls/10.png":ue,"./assets/balls/11.png":he,"./assets/balls/12.png":ce,"./assets/balls/16.png":de,"./assets/balls/17.png":be,"./assets/balls/18.png":pe,"./assets/balls/19.png":fe,"./assets/balls/2.png":ge,"./assets/balls/20.png":me,"./assets/balls/21.png":_e,"./assets/balls/22.png":ye,"./assets/balls/23.png":we,"./assets/balls/24.png":ve,"./assets/balls/25.png":Be,"./assets/balls/26.png":xe,"./assets/balls/27.png":Ce,"./assets/balls/28.png":Me,"./assets/balls/29.png":Se,"./assets/balls/3.png":De,"./assets/balls/30.png":Pe,"./assets/balls/31.png":Ie,"./assets/balls/32.png":Oe,"./assets/balls/4.png":Ee,"./assets/balls/5.png":Te,"./assets/balls/6.png":Re,"./assets/balls/7.png":ze,"./assets/balls/8.png":Le}),E=Object.fromEntries(Object.entries(Ne).map(([t,e])=>{const s=t.match(/(\d+)\.png$/)[1],o=new Image;return o.src=e,[s,o]})),r=document.getElementById("main-canvas"),Y=r.getContext("2d"),_=new OffscreenCanvas(r.width,r.height),g=_.getContext("2d",{alpha:!1});let P=new i,m=[],z=-1,d=[],w=[],v=[],$=[],se=0,B=0,k=0,T=Math.round(Math.random())+1,W=!1,M=!0,O=!1;const C=[0,3,5,8,10,15];let S=C[2];const L=75,We=50,G=37,X=300,j=500;let f=[],J=-1;const Xe=18,A=new Image;A.src=Ae;let y=null;const Fe=t=>{for(const e of w)if(t.isCollidingBlock(e))return!0;for(const e of d)if(t.isCollidingBubble(e))return!0;return!1};function N(t){return Object.values(E)[t]||E[1]}function U(){return Math.floor(Math.random()*Object.keys(E).length)}function Ye(){const t=new i(600,200),e=40,s="#92D8F8",o="#363858",n=new i(700,250);v.push(new I(new i((r.width-n.x)/2,r.height-n.y-100),n,"START",u=>{ie(),B=1},"pink")),v.push(new I(new i((r.width-t.x)/2,r.height-t.y*1-400),t,M?"Blocks: Enabled":"Blocks: Disabled",u=>{M=!M,u.text=M?"Blocks: Enabled":"Blocks: Disabled",u.color=M?s:o},M?s:o)),v.push(new I(new i((r.width-t.x)/2,r.height-t.y*2-400-e*1),t,O?"Require bounce: Enabled":"Require bounce: Disabled",u=>{O=!O,u.text=O?"Require bounce: Enabled":"Require bounce: Disabled",u.color=O?s:o},O?s:o));const a=`rgb(${-(S/C[C.length-1])*100+200}, 233, 203)`;v.push(new I(new i((r.width-t.x)/2,r.height-t.y*3-400-e*2),t,`Small balls: ${S}`,u=>{const x=C.indexOf(S);S=C[(x+1)%C.length];const F=S/C[C.length-1];u.color=`rgb(${-F*100+200}, 233, 203)`,u.text=`Small balls: ${S}`},a));const h=new i(r.width/2,350),b=new i(80,L*2),c="#dbedd0",p=200;if(f.length===0){f[0]=U();do f[1]=U();while(f[0]===f[1])}for(let u=0;u<=1;u++){const x=u*2-1;$.push(new q(h.add(new i(x*p,0)),L,new i,N(f[u]),u+1)),v.push(new I(h.add(new i(x*p-L-b.x,-b.y/2)),b,"<",F=>{f[u]=(f[u]-1)%Object.keys(E).length,f[u]<0&&(f[u]=Object.keys(E).length-1),$[u].sprite=N(f[u])},c,20)),v.push(new I(h.add(new i(x*p+L,-b.y/2)),b,">",F=>{f[u]=(f[u]+1)%Object.keys(E).length,$[u].sprite=N(f[u])},c,20))}}function Ge(){const t=new i(30,700),e=t.x/5,s=new i(r.width-e-t.x,(r.height-t.y)/2);if(w.push(new R(new i(e,(r.height-t.y)/2),t.mult(1))),w.push(new R(s,t.mult(1))),M){const o=Math.round(Math.random())+1;if(o===1){const n=230+170*Math.random(),l=new i(e+t.x+Math.random()*(r.width-n-2*(e+t.x)),(r.height-t.x)/2);w.push(new R(l,new i(n,t.x)))}else if(o===2){const n=170+80*Math.random(),l=100+50*Math.random(),a=new i(e+t.x+Math.random()*(r.width-n-l-2*(e+t.x)),(r.height-t.x)/2),h=new i(a.x+n+Math.random()*(r.width-n-l-a.x-e-t.x),(r.height-t.x)/2);w.push(new R(a,new i(n,t.x))),w.push(new R(h,new i(l,t.x)))}}}A.onload=t=>{K()};function K(){_.width=r.width,_.height=r.height,g.clearRect(0,0,_.width,_.height),g.fillStyle="#efe1e1",g.fillRect(0,0,_.width,_.height),g.save(),g.filter="drop-shadow(4px 4px 5px black) brightness(0.1) opacity(10%)",g.scale(2,2),g.drawImage(A,0,0,A.width,A.height),g.restore(),M&&B!==2&&(g.lineWidth=3,g.strokeStyle="rgba(0, 0, 0, 0.4)",g.beginPath(),g.moveTo(_.width/10,_.height/2),g.lineTo(9*_.width/10,_.height/2),g.stroke());for(const t of w)t.render(g)}function Q(t,e,s,o){const n=+o*2-1,l=new q(t,L,new i,e,s);d.push(l);for(let c=0;c<=5;c++)d.push(new q(new i(c/5*r.width,t.y+X/2*n),We,new i,e,s));const a=150;let h=0,b=0;for(;h<S&&b<=a;){const c=new q(new i(G+Math.random()*(r.width-G*2),t.y-X/2*n*Math.random()),G,new i,e,s);Fe(c)||(h++,d.push(c)),b++}b>=a&&console.error("couldn't spawn all small bubbles :(")}function ne(){oe(),Ge(),Ye();const t=new i(r.width/2,X),e=new i(r.width/2,r.height-X);Q(t,N(f[0]),1,!0),Q(e,N(f[1]),2,!1)}function ie(){B=0,d=[],w=[],v=[],$=[],T=Math.round(Math.random())+1,ne(),K()}function oe(){r.height=1600,r.width=950}function V(t){B=2,w=[],K(),k=t}function He(){T===1?T=2:T=1}const ke=()=>{for(const t of d)if(t.velocity.length()>.24)return!1;return!0},Je=()=>{let t=!1,e=!1;for(const s of d)if(s.player===1?t=!0:e=!0,t&&e)break;return t^e?t?2:1:0};function ee(){d.forEach((t,e)=>{t.update();for(const s of d.slice(e+1))t.collideBubble(s);for(const s of w)t.collideBlock(s)})}function Ke(t){if(se=t,d=d.filter(e=>!e.outOfBounds(r.width,r.height)),ee(),ke()&&W){for(let e=0;e<1e3;e++)ee();if(W=!1,d.length===0)V(0);else{const e=Je();e!==0&&V(e)}}}function Ze(t){t.clearRect(0,0,r.width,r.height),t.drawImage(_,0,0);{t.lineWidth=2;for(let s=1;s<=2;s++){const o=d.filter(n=>n.player===s);t.beginPath(),t.strokeStyle=`rgba(0, 0, 0, ${.2})`,o.forEach((n,l)=>{for(const a of o.slice(l+1))n.pos.sub(a.pos).length()<=600&&(t.moveTo(Math.floor(n.pos.x),Math.floor(n.pos.y)),t.lineTo(Math.floor(a.pos.x),Math.floor(a.pos.y)))}),t.stroke()}}for(const e of d)e.player===T&&!W&&(t.fillStyle="rgba(0,0,0,0.3)",H(t,e.pos,e.radius+e.radius*.15*(Math.sin(se/250)+1))),e.render(t);if(y){const e=y.pos,s=new i(r.width,r.height).length(),o=e.add(e.sub(P).mult(J).normalize().mult(s)),n=Ve(e,o,y.radius,y,200);n&&(t.fillStyle=y.player===2?"rgba(158, 152, 250, 0.3)":"rgba(250, 163, 152, 0.3)",H(t,n,y.radius));let l=e.sub(P);t.strokeStyle="rgb(0 0 0)",l.length()>j&&(l=l.normalize().mult(j),t.strokeStyle="rgb(120 0 0)");const a=l.length()/j;let h=e.add(l.mult(J));t.beginPath(),t.setLineDash([5+5*a,17*a]),t.lineWidth=6,t.moveTo(e.x,e.y),t.lineTo(h.x,h.y),t.stroke(),t.setLineDash([])}}function Ue(t){t.clearRect(0,0,r.width,r.height),t.drawImage(_,0,0);let e="";k===0?e="Draw":k===1?e="Player 1 won!":e="Player 2 won!",t.fillStyle="black",t.textAlign="center",t.font='bold 120px "verdana", sans-serif',t.fillText(e,r.width/2,r.height/2),t.font='60px "verdana", sans-serif',t.fillText("Click to continue...",r.width/2,r.height*2/3)}function Qe(t){t.clearRect(0,0,r.width,r.height),t.drawImage(_,0,0);for(const e of v)e.render(t);for(const e of $)e.render(t);t.fillStyle="black",t.textAlign="center",t.font='bold 100px "Helvetica", sans-serif',t.fillText("Bubble Bounce",r.width/2,r.height/8)}function Ve(t,e,s,o,n=100){const l=e.sub(t),a=new q(new i,s);for(let h=1;h<=n;h++){const b=h/n,c=t.add(l.mult(b));a.pos=c;for(let p=0;p<d.length;p++){const u=d[p];if(JSON.stringify(u)!==JSON.stringify(o)&&a.isCollidingBubble(u))return a.pos.mult(1)}for(const p of w)if(a.isCollidingBlock(p))return a.pos.mult(1)}return null}function et(t){for(let e=0;e<d.length;e++){const s=d[e];if(s.isInside(t))return s}return null}function D(t){const e=r.getBoundingClientRect(),s=r.width/e.width,o=r.height/e.height;return new i((t.clientX-e.left)*s,(t.clientY-e.top)*o)}window.addEventListener("resize",oe);document.addEventListener("pointermove",t=>{P=D(t)});document.addEventListener("pointerdown",t=>{if(m.push(t),m.length===2&&D(m[0]).add(D(m[1]).sub(D(m[0])).div(2)),P=D(t),B===0){for(const e of v)e.checkClick(D(t));return}if(B===2){ie();return}W||(y=et(P),y&&y.player!==T&&(y=null))});function tt(t){const e=m.findIndex(s=>s.pointerId===t.pointerId);m.splice(e,1)}document.addEventListener("pointerup",t=>{if(P=D(t),tt(t),m.length<2&&(z=-1),y){const e=y.pos.sub(P).mult(J);y.velocity=e.normalize().mult(Math.min(e.length(),j)/j*Xe),y=null,He(),W=!0}});const le=()=>{r.style.transform="scale(1)"},re=()=>{r.style.transform="scale(0.8)"};document.addEventListener("pointermove",t=>{const e=m.findIndex(s=>s.pointerId===t.pointerId);if(m[e]=t,m.length===2){const s=new i(m[0].clientX,m[0].clientY),o=new i(m[1].clientX,m[1].clientY),n=s.sub(o).length(),l=13;z>0&&(n>z+l&&le(),n<z-l&&re()),z=n}});document.addEventListener("wheel",t=>{t.deltaY<0?le():re()});ne();(()=>{function t(e){window.requestAnimationFrame(t),B===0?Qe(Y):B===1?(Ke(e),Ze(Y)):B===2&&Ue(Y)}t()})();
