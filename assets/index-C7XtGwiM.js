(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();const pe="/bubble_bounce/assets/1-msowq8PV.png",ge="/bubble_bounce/assets/10-C2b_EmXV.png",me="/bubble_bounce/assets/11-RrZkbv2B.png",we="/bubble_bounce/assets/12-Cj-w1vrm.png",ye="/bubble_bounce/assets/16-CIkSIS7u.png",_e="/bubble_bounce/assets/17-CCe0iIc4.png",ve="/bubble_bounce/assets/18-wsb_O-g9.png",Be="/bubble_bounce/assets/19-B4aX6oMj.png",Ce="/bubble_bounce/assets/2-CZcekOIb.png",Se="/bubble_bounce/assets/20-CBLc80yN.png",Me="/bubble_bounce/assets/21-B6YSg9Ux.png",Pe="/bubble_bounce/assets/22-Bey-tXPl.png",xe="/bubble_bounce/assets/23-CfGDoL72.png",De="/bubble_bounce/assets/24-BHXDI67n.png",Ie="/bubble_bounce/assets/25-D-lPi3tR.png",Ee="/bubble_bounce/assets/26-qODNZ1eh.png",Oe="/bubble_bounce/assets/27-CLKhPhSb.png",Te="/bubble_bounce/assets/28-CYOAUwfl.png",ke="/bubble_bounce/assets/29-D7x_Qp9C.png",ze="/bubble_bounce/assets/3-_feIaOhr.png",Re="/bubble_bounce/assets/30-CaNdivBa.png",Le="/bubble_bounce/assets/31-B-NKGiGE.png",qe="/bubble_bounce/assets/32-8ghHFANu.png",We="/bubble_bounce/assets/4-DD3Yexrc.png",$e="/bubble_bounce/assets/5-Btr9iXW_.png",je="/bubble_bounce/assets/6-BGMDbjSf.png",Xe="/bubble_bounce/assets/7-CMnHBFWr.png",Ae="/bubble_bounce/assets/8-kXJG1xv3.png",Ne=0,te=.992,Ye=.96;class o{x;y;constructor(e=0,s=0){this.x=e,this.y=s}clone(){return new o(this.x,this.y)}squared(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){var e=this.length();return e>0?this.div(e):new o(this.x,this.y)}div(e){return e instanceof o?new o(this.x/e.x,this.y/e.y):new o(this.x/e,this.y/e)}mult(e){return e instanceof o?new o(this.x*e.x,this.y*e.y):new o(this.x*e,this.y*e)}add(e){return e instanceof o?new o(this.x+e.x,this.y+e.y):new o(this.x+e,this.y+e)}sub(e){return e instanceof o?new o(this.x-e.x,this.y-e.y):new o(this.x-e,this.y-e)}negate(){return new o(-this.x,-this.y)}dot(e){return this.x*e.x+this.y*e.y}static lerp(e,s,n){return e.add(s.sub(e).mult(n))}}class z{pos;dim;borderRadius;constructor(e,s,n=1){this.pos=e,this.dim=s,this.borderRadius=n}clone(){return new z(this.pos.clone(),this.dim.clone(),this.borderRadius)}getCenter(){return this.pos.add(this.dim.div(2))}render(e){e.fillStyle="F0EBE3",he(e,Math.floor(this.pos.x),Math.floor(this.pos.y),this.dim.x,this.dim.y,this.borderRadius+15)}}class O{pos;dim;onClick;text;color;borderRadius;constructor(e,s,n,i,l="red",a=55){this.pos=e,this.dim=s,this.text=n,this.onClick=i,this.color=l,this.borderRadius=a}getCenter(){return this.pos.add(this.dim.div(2))}isInside(e){return e.x>=this.pos.x&&e.x<=this.pos.x+this.dim.x&&e.y>=this.pos.y&&e.y<=this.pos.y+this.dim.y}checkClick(e){this.isInside(e)&&this.onClick(this)}render(e){e.fillStyle=this.color,he(e,Math.floor(this.pos.x),Math.floor(this.pos.y),this.dim.x,this.dim.y,this.borderRadius),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.font=`${Math.floor(this.dim.y/3)}px "verdana", sans-serif`;const s=this.getCenter();e.fillText(this.text,s.x,s.y,this.dim.x)}}class E{pos;radius;velocity;spriteIndex;rotSpeed;rot=0;player;bouncedOffWall=!1;constructor(e,s,n,i,l=0){this.pos=e,this.radius=s,this.velocity=n,this.spriteIndex=i,this.rotSpeed=0,this.player=l}clone(){const e=new E(this.pos.clone(),this.radius,this.velocity.clone(),this.spriteIndex,this.player);return e.rot=this.rot,e.rotSpeed=this.rotSpeed,e.bouncedOffWall=this.bouncedOffWall,e}mass(){return Math.PI*this.radius*this.radius/100}kineticEnergy(){return this.mass()/2*this.velocity.squared()}outOfBounds(e,s){const n=this.radius+this.radius/3;return this.pos.x-this.radius+n<=0||this.pos.x+this.radius-n>=e||this.pos.y-this.radius+n<=0||this.pos.y+this.radius-n>=s}isCollidingBubble(e){const s=this.pos.sub(e.pos),n=this.radius+e.radius;return s.length()<=n}isCollidingBlock(e){const s=e.borderRadius;let n=!1;const i=Math.max(e.pos.x+s,Math.min(this.pos.x,e.pos.x+e.dim.x-s)),l=Math.max(e.pos.y+s,Math.min(this.pos.y,e.pos.y+e.dim.y-s)),a=new o(i,l);this.pos.sub(a).length()<=this.radius&&(n=!0);const g=[new o(e.pos.x+s,e.pos.y+s),new o(e.pos.x+e.dim.x-s,e.pos.y+s),new o(e.pos.x+s,e.pos.y+e.dim.y-s),new o(e.pos.x+e.dim.x-s,e.pos.y+e.dim.y-s)];for(const u of g)if(this.pos.sub(u).length()<=this.radius+s){n=!0;break}return n}collideBlock(e){const s=e.borderRadius;let n=!1,i=new o(0,0),l=0;const a=Math.max(e.pos.x+s,Math.min(this.pos.x,e.pos.x+e.dim.x-s)),h=Math.max(e.pos.y+s,Math.min(this.pos.y,e.pos.y+e.dim.y-s)),g=new o(a,h),u=this.pos.sub(g).length();u<=this.radius&&(n=!0,a===e.pos.x+s?i=new o(-1,0):a===e.pos.x+e.dim.x-s?i=new o(1,0):h===e.pos.y+s?i=new o(0,-1):h===e.pos.y+e.dim.y-s&&(i=new o(0,1)),l=this.radius-u);const m=[new o(e.pos.x+s,e.pos.y+s),new o(e.pos.x+e.dim.x-s,e.pos.y+s),new o(e.pos.x+s,e.pos.y+e.dim.y-s),new o(e.pos.x+e.dim.x-s,e.pos.y+e.dim.y-s)];for(const v of m){const c=this.pos.sub(v).length();if(c<=this.radius+s){n=!0,i=this.pos.sub(v).normalize(),l=this.radius+s-c;break}}if(n){this.pos=this.pos.add(i.mult(l));const v=this.velocity.dot(i);return this.velocity=this.velocity.sub(i.mult(2*v)),this.velocity=this.velocity.mult(Ye),this.bouncedOffWall=!0,!0}return!1}collideBubble(e){const s=this.pos.sub(e.pos),n=this.radius+e.radius,i=s.length();if(i<=n){const l=s.normalize(),a=this.velocity.sub(e.velocity),h=l.mult(2*a.dot(l)/(this.mass()+e.mass()));this.velocity=this.velocity.sub(h.mult(e.mass())),e.velocity=e.velocity.add(h.mult(this.mass()));const g=n-i,u=l.mult(g/2);this.pos=this.pos.add(u),e.pos=e.pos.sub(u);const m=h.normalize().dot(new o(-this.velocity.y,this.velocity.x).normalize());return this.rotSpeed=m/100,e.rotSpeed=m/100,!0}return!1}update(){this.velocity.y+=Ne*this.mass(),this.velocity=this.velocity.mult(te),this.rotSpeed*=te,this.rot+=this.rotSpeed,this.pos=this.pos.add(this.velocity)}render(e,s){this.rot=this.rot??Math.PI*2*Math.random(),Fe(e,s,this.pos,this.radius*2,this.rot)}simpleRender(e,s="rgb(200 0 0)"){e.fillStyle=s,K(e,this.pos,this.radius)}isInside(e){return e.sub(this.pos).length()<=this.radius}}function Fe(t,e,s,n,i){t.save(),t.translate(Math.floor(s.x),Math.floor(s.y)),t.rotate(i),t.drawImage(e,-n/2,-n/2,n,n),t.restore()}function K(t,e,s){t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),s,0,Math.PI*2),t.fill()}function he(t,e,s,n,i,l){t.strokeStyle="rgba(0, 0, 0, 1.0)",t.lineWidth=6,t.beginPath(),t.moveTo(e+l,s),t.lineTo(e+n-l,s),t.arcTo(e+n,s,e+n,s+l,l),t.lineTo(e+n,s+i-l),t.arcTo(e+n,s+i,e+n-l,s+i,l),t.lineTo(e+l,s+i),t.arcTo(e,s+i,e,s+i-l,l),t.lineTo(e,s+l),t.arcTo(e,s,e+l,s,l),t.stroke(),t.fill()}const Ge="/bubble_bounce/assets/abstract_dots-DTrwscDn.svg";class Ke{canvas;callbacks;evCache=[];previousEvDistance=-1;keyListeners=new Map;constructor(e,s){this.canvas=e,this.callbacks=s,window.addEventListener("resize",this.callbacks.onResize),document.addEventListener("pointerdown",this.handlePointerDown.bind(this)),document.addEventListener("pointerup",this.handlePointerUp.bind(this)),document.addEventListener("pointermove",this.handlePointerMove.bind(this)),document.addEventListener("wheel",this.handleWheel.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this))}onKey(e,s){return this.keyListeners.set(e,s),this}removeEvent(e){const s=this.evCache.findIndex(n=>n.pointerId===e.pointerId);this.evCache.splice(s,1)}convertEventPos(e){const s=this.canvas.getBoundingClientRect(),n=this.canvas.width/s.width,i=this.canvas.height/s.height;return new o((e.clientX-s.left)*n,(e.clientY-s.top)*i)}handlePointerMove(e){const s=this.convertEventPos(e);this.callbacks.onPointerMove(s);const n=this.evCache.findIndex(i=>i.pointerId===e.pointerId);if(this.evCache[n]=e,this.evCache.length===2){const i=new o(this.evCache[0].clientX,this.evCache[0].clientY),l=new o(this.evCache[1].clientX,this.evCache[1].clientY),a=i.sub(l).length(),h=13;this.previousEvDistance>0&&(a>this.previousEvDistance+h&&this.callbacks.onPinch("in"),a<this.previousEvDistance-h&&this.callbacks.onPinch("out")),this.previousEvDistance=a}}handlePointerDown(e){const s=this.convertEventPos(e);this.callbacks.onPointerDown(s),this.evCache.push(e)}handlePointerUp(e){const s=this.convertEventPos(e);this.callbacks.onPointerUp(s),this.removeEvent(e),this.evCache.length<2&&(this.previousEvDistance=-1)}handleWheel(e){this.callbacks.onScroll(e.deltaY)}handleKeyDown(e){const s=this.keyListeners.get(e.key);s&&(e.preventDefault(),s())}}class ce{static set(e,s){try{const n=JSON.stringify(s);return localStorage.setItem(e,n),!0}catch(n){return console.error(`Error saving to localStorage for key "${e}":`,n),!1}}static get(e,s){try{const n=localStorage.getItem(e);return n===null?s===void 0?null:s:JSON.parse(n)}catch(n){return console.error(`Error reading from localStorage for key "${e}":`,n),s===void 0?null:s}}static remove(e){try{localStorage.removeItem(e)}catch(s){console.error(`Error removing item from localStorage for key "${e}":`,s)}}}const He=Object.assign({"./assets/balls/1.png":pe,"./assets/balls/10.png":ge,"./assets/balls/11.png":me,"./assets/balls/12.png":we,"./assets/balls/16.png":ye,"./assets/balls/17.png":_e,"./assets/balls/18.png":ve,"./assets/balls/19.png":Be,"./assets/balls/2.png":Ce,"./assets/balls/20.png":Se,"./assets/balls/21.png":Me,"./assets/balls/22.png":Pe,"./assets/balls/23.png":xe,"./assets/balls/24.png":De,"./assets/balls/25.png":Ie,"./assets/balls/26.png":Ee,"./assets/balls/27.png":Oe,"./assets/balls/28.png":Te,"./assets/balls/29.png":ke,"./assets/balls/3.png":ze,"./assets/balls/30.png":Re,"./assets/balls/31.png":Le,"./assets/balls/32.png":qe,"./assets/balls/4.png":We,"./assets/balls/5.png":$e,"./assets/balls/6.png":je,"./assets/balls/7.png":Xe,"./assets/balls/8.png":Ae}),$=Object.fromEntries(Object.entries(He).map(([t,e])=>{const s=t.match(/(\d+)\.png$/),n=s?s[1]:"1",i=new Image;return i.src=e,[n,i]})),r=document.getElementById("main-canvas");if(!r)throw new Error("Canvas not found");const j=r.getContext("2d");if(!j)throw new Error("2D context not found");const w=new OffscreenCanvas(r.width,r.height),f=w.getContext("2d",{alpha:!1});if(!f)throw new Error("2D context not found for offscreen canvas");let W=new o,d=[],y=[],C=[],R=[],ue=0,_=0,T=0,M=Math.round(Math.random())+1,L=!1,Z=null,q=!0,S=!0,x=!1;const P=[0,3,5,8,10,15];let D=P[2];const I=75,Ue=50,F=37,N=300,X=500,de=.6,Je=.03;let b=[],H=-1,se;const Ze=18,A=new Image;A.src=Ge;let p=null;const Qe=t=>{for(const e of y)if(t.isCollidingBlock(e))return!0;for(const e of d)if(t.isCollidingBubble(e))return!0;return!1};function Q(t){return Object.values($)[t]||$[1]}function ne(){return Math.floor(Math.random()*Object.keys($).length)}function ie(){b[0]=ne();do b[1]=ne();while(b[0]===b[1])}function Ve(){const t=new o(600,200),e=40,s="#92D8F8",n="#363858",i=new o(700,250);C.push(new O(new o((r.width-i.x)/2,r.height-i.y-100),i,"START",c=>{U(),_=1},"pink")),C.push(new O(new o((r.width-t.x)/2,r.height-t.y*1-400),t,S?"Blocks: Enabled":"Blocks: Disabled",c=>{S=!S,c.text=S?"Blocks: Enabled":"Blocks: Disabled",c.color=S?s:n,k()},S?s:n)),C.push(new O(new o((r.width-t.x)/2,r.height-t.y*2-400-e*1),t,x?"Require bounce: Enabled":"Require bounce: Disabled",c=>{x=!x,c.text=x?"Require bounce: Enabled":"Require bounce: Disabled",c.color=x?s:n,k()},x?s:n));const a=`rgb(${-(D/P[P.length-1])*100+200}, 233, 203)`;C.push(new O(new o((r.width-t.x)/2,r.height-t.y*3-400-e*2),t,`Small bubbles: ${D}`,c=>{const B=P.indexOf(D);D=P[(B+1)%P.length];const Y=D/P[P.length-1];c.color=`rgb(${-Y*100+200}, 233, 203)`,c.text=`Small bubbles: ${D}`,k()},a));const h=new o(r.width/2,300),g=new o(200,110);C.push(new O(new o((r.width-g.x)/2,h.y+I/2+g.y-e-20),g,"Randomize",c=>{ie();for(let B=0;B<R.length;B++)R[B].spriteIndex=b[B];k()},a));const u=new o(80,I*2),m="#dbedd0",v=200;b.length===0&&ie();for(let c=0;c<=1;c++){const B=c*2-1;R.push(new E(h.add(new o(B*v,0)),I,new o,b[c],c+1)),C.push(new O(h.add(new o(B*v-I-u.x,-u.y/2)),u,"<",Y=>{b[c]=(b[c]-1)%Object.keys($).length,b[c]<0&&(b[c]=Object.keys($).length-1),R[c].spriteIndex=b[c],k()},m,20)),C.push(new O(h.add(new o(B*v+I,-u.y/2)),u,">",Y=>{b[c]=(b[c]+1)%Object.keys($).length,R[c].spriteIndex=b[c],k()},m,20))}}function et(){const t=new o(30,700),e=t.x/5,s=new o(r.width-e-t.x,(r.height-t.y)/2);if(y.push(new z(new o(e,(r.height-t.y)/2),t.mult(1))),y.push(new z(s,t.mult(1))),S){const n=Math.round(Math.random())+1;if(n===1){const i=230+170*Math.random(),l=new o(e+t.x+Math.random()*(r.width-i-2*(e+t.x)),(r.height-t.x)/2);y.push(new z(l,new o(i,t.x)))}else if(n===2){const i=170+80*Math.random(),l=100+50*Math.random(),a=new o(e+t.x+Math.random()*(r.width-i-l-2*(e+t.x)),(r.height-t.x)/2),h=new o(a.x+i+Math.random()*(r.width-i-l-a.x-e-t.x),(r.height-t.x)/2);y.push(new z(a,new o(i,t.x))),y.push(new z(h,new o(l,t.x)))}}}A.onload=t=>{V()};function V(){w.width=r.width,w.height=r.height,f.clearRect(0,0,w.width,w.height),f.fillStyle="#efe1e1",f.fillRect(0,0,w.width,w.height),f.save(),f.filter="drop-shadow(4px 4px 5px black) brightness(0.1) opacity(10%)",f.scale(2,2),f.drawImage(A,0,0,A.width,A.height),f.restore(),S&&_!==2&&(f.lineWidth=3,f.strokeStyle="rgba(0, 0, 0, 0.4)",f.beginPath(),f.moveTo(w.width/10,w.height/2),f.lineTo(9*w.width/10,w.height/2),f.stroke());for(const t of y)t.render(f)}function oe(t,e,s,n){const i=+n*2-1,l=new E(t,I,new o,e,s);d.push(l);for(let u=0;u<=5;u++)d.push(new E(new o(u/5*r.width,t.y+N/2*i),Ue,new o,e,s));const a=150;let h=0,g=0;for(;h<D&&g<=a;){const u=new E(new o(F+Math.random()*(r.width-F*2),t.y-N/2*i*Math.random()),F,new o,e,s);Qe(u)||(h++,d.push(u)),g++}g>=a&&console.error("couldn't spawn all small bubbles :(")}function be(){fe(),dt(ut()),et(),Ve();const t=new o(r.width/2,N),e=new o(r.width/2,r.height-N);oe(t,b[0],1,!0),oe(e,b[1],2,!1)}function tt(){const t={onPointerMove:e=>{W=e},onPointerDown:e=>{if(W=e,_===0){for(const s of C)s.checkClick(e);return}if(_===2){U();return}_===1&&!L&&(p=ct(W),p&&p.player!==M&&(p=null))},onPointerUp(e){if(p){const s=p.pos.sub(W).mult(H);if(s.length()-p.radius<=20){p=null;return}q=!0,Z=ee(),p.velocity=s.normalize().mult(Math.min(s.length(),X)/X*Ze),p=null,nt(),L=!0}},onScroll(e){e<0?re():ae()},onPinch:e=>{e==="in"?re():e==="out"&&ae()},onResize:()=>{fe()}};se=new Ke(r,t),se.onKey("Escape",()=>{(_===1||_===2)&&U()})}function U(){_=0,d=[],y=[],C=[],R=[],M=Math.round(Math.random())+1,be(),V()}function ee(){return{bubbles:d.map(t=>t.clone()),blocks:y.map(t=>t.clone()),currentPlayer:M,firstBounce:q}}function st(t){d=t.bubbles,y=t.blocks,M=t.currentPlayer,q=t.firstBounce}function fe(){r.height=1600,r.width=950}function le(t){_=2,y=[],V(),T=t}function nt(){M===1?M=2:M=1}const J=()=>{let t=0;for(const e of d)e.velocity.length()>t&&(t=e.velocity.length());return t},it=()=>{let t=!1,e=!1;for(const s of d)if(s.player===1?t=!0:e=!0,t&&e)break;return t&&e?0:t?2:1};function G(){d.forEach((t,e)=>{t.update();for(const s of d.slice(e+1))t.collideBubble(s)&&(q&&x&&t.player===M!=(s.player===M)&&st(Z??ee()),q=!1);for(const s of y)t.collideBlock(s)&&(q=!1)})}function ot(t){if(ue=t,d=d.filter(e=>!e.outOfBounds(r.width,r.height)),G(),J()<de&&L)for(let e=0;e<2;e++)G();if(J()<Je&&L){for(let e=0;e<1e3;e++)G();if(q=!0,L=!1,Z=ee(),d.length===0)le(0);else{const e=it();e!==0&&le(e)}}}function lt(t){t.clearRect(0,0,r.width,r.height),t.drawImage(w,0,0);{t.lineWidth=2;for(let s=1;s<=2;s++){const n=d.filter(i=>i.player===s);t.beginPath(),t.strokeStyle=`rgba(0, 0, 0, ${.2})`,n.forEach((i,l)=>{for(const a of n.slice(l+1))i.pos.sub(a.pos).length()<=300&&(t.moveTo(Math.floor(i.pos.x),Math.floor(i.pos.y)),t.lineTo(Math.floor(a.pos.x),Math.floor(a.pos.y)))}),t.stroke()}}for(const e of d)e.player===M&&!L&&(t.fillStyle="rgba(0,0,0,0.3)",K(t,e.pos,e.radius+e.radius*.15*(Math.sin(ue/250)+1))),e.render(t,Q(e.spriteIndex));if(p){const e=p.pos,s=new o(r.width,r.height).length(),n=e.add(e.sub(W).mult(H).normalize().mult(s)),i=ht(e,n,p.radius,p,200);i&&(t.fillStyle=p.player===2?"rgba(158, 152, 250, 0.3)":"rgba(250, 163, 152, 0.3)",K(t,i,p.radius));let l=e.sub(W);t.strokeStyle="rgb(0 0 0)",l.length()>X&&(l=l.normalize().mult(X),t.strokeStyle="rgb(120 0 0)");const a=l.length()/X;let h=e.add(l.mult(H));t.beginPath(),t.setLineDash([5+5*a,17*a]),t.lineWidth=6,t.moveTo(e.x,e.y),t.lineTo(h.x,h.y),t.stroke(),t.setLineDash([])}if(J()<de&&L){t.save(),t.fillStyle="rgba(43, 38, 38, 0.9)";const e=20,s=r.width/2+e/2,n=120,i=80;t.beginPath(),t.moveTo(s-e-i,n-i/2),t.lineTo(s-e,n),t.lineTo(s-e-i,n+i/2),t.closePath(),t.fill(),t.beginPath(),t.moveTo(s+e,n-i/2),t.lineTo(s+e+i,n),t.lineTo(s+e,n+i/2),t.closePath(),t.fill(),t.restore()}}function rt(t){if(t.clearRect(0,0,r.width,r.height),t.drawImage(w,0,0),T!==0){console.log("winningPlayer",T);const s=new E(new o(r.width/2,r.height/4),I*2,new o,b[T===1?1:0],T);s.rot=0,s.render(t,Q(s.spriteIndex))}let e="";T===0?e="Draw":T===1?e="Player 1 won!":e="Player 2 won!",t.fillStyle="black",t.textAlign="center",t.font='bold 120px "verdana", sans-serif',t.fillText(e,r.width/2,r.height/2),t.font='60px "verdana", sans-serif',t.fillText("Click to continue...",r.width/2,r.height*2/3)}function at(t){t.clearRect(0,0,r.width,r.height),t.drawImage(w,0,0);for(const n of C)n.render(t);for(const n of R)n.render(t,Q(n.spriteIndex));const e=new o(r.width/2,300),s=200;t.fillStyle="black",t.textAlign="center",t.font='bold 40px "Helvetica", sans-serif',t.fillText("P2:",e.x-s,e.y-I-20),t.fillText("P1:",e.x+s,e.y-I-20),t.font='bold 100px "Helvetica", sans-serif',t.fillText("Bubble Bounce",r.width/2,r.height/12)}function ht(t,e,s,n,i=100){const l=e.sub(t),a=new E(new o,s,new o,1);for(let h=1;h<=i;h++){const g=h/i,u=t.add(l.mult(g));a.pos=u;for(let m=0;m<d.length;m++){const v=d[m];if(v!==n&&a.isCollidingBubble(v))return a.pos.mult(1)}for(const m of y)if(a.isCollidingBlock(m))return a.pos.mult(1)}return null}function ct(t){for(let e=0;e<d.length;e++){const s=d[e];if(s.isInside(t))return s}return null}function ut(){const t={smallBallCount:P[2],enableMiddleBlocks:!0,requiredBounce:!1},e=ce.get("bubble_bounce_settings");return e||t}function dt(t){D=t.smallBallCount,S=t.enableMiddleBlocks,x=t.requiredBounce,k()}function k(){ce.set("bubble_bounce_settings",{chosenSprites:b,smallBallCount:D,enableMiddleBlocks:S,requiredBounce:x})}const re=()=>{r.style.transform="scale(1)"},ae=()=>{r.style.transform="scale(0.8)"};be();tt();(()=>{function t(e){if(window.requestAnimationFrame(t),!j)throw new Error("Main loop: 2D context not found");_===0?at(j):_===1?(ot(e),lt(j)):_===2&&rt(j)}t(0)})();
