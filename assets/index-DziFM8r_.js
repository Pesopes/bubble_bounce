(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function s(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=s(n);fetch(n.href,l)}})();const oe="/bubble_bounce/assets/1-msowq8PV.png",le="/bubble_bounce/assets/10-C2b_EmXV.png",re="/bubble_bounce/assets/11-RrZkbv2B.png",ae="/bubble_bounce/assets/12-Cj-w1vrm.png",he="/bubble_bounce/assets/16-CIkSIS7u.png",ce="/bubble_bounce/assets/17-CCe0iIc4.png",ue="/bubble_bounce/assets/18-wsb_O-g9.png",de="/bubble_bounce/assets/19-B4aX6oMj.png",be="/bubble_bounce/assets/2-CZcekOIb.png",pe="/bubble_bounce/assets/20-CBLc80yN.png",fe="/bubble_bounce/assets/21-B6YSg9Ux.png",ge="/bubble_bounce/assets/22-Bey-tXPl.png",me="/bubble_bounce/assets/23-CfGDoL72.png",_e="/bubble_bounce/assets/24-BHXDI67n.png",we="/bubble_bounce/assets/25-D-lPi3tR.png",ye="/bubble_bounce/assets/26-qODNZ1eh.png",ve="/bubble_bounce/assets/27-CLKhPhSb.png",Be="/bubble_bounce/assets/28-CYOAUwfl.png",Ce="/bubble_bounce/assets/29-D7x_Qp9C.png",xe="/bubble_bounce/assets/3-_feIaOhr.png",Me="/bubble_bounce/assets/30-CaNdivBa.png",Pe="/bubble_bounce/assets/31-B-NKGiGE.png",De="/bubble_bounce/assets/32-8ghHFANu.png",Se="/bubble_bounce/assets/4-DD3Yexrc.png",Ee="/bubble_bounce/assets/5-Btr9iXW_.png",Ie="/bubble_bounce/assets/6-BGMDbjSf.png",Oe="/bubble_bounce/assets/7-CMnHBFWr.png",Te="/bubble_bounce/assets/8-kXJG1xv3.png",Re=0,U=.992,ze=.96;class o{x;y;constructor(e=0,s=0){this.x=e,this.y=s}squared(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){var e=this.length();return e>0?this.div(e):new o(this.x,this.y)}div(e){return e instanceof o?new o(this.x/e.x,this.y/e.y):new o(this.x/e,this.y/e)}mult(e){return e instanceof o?new o(this.x*e.x,this.y*e.y):new o(this.x*e,this.y*e)}add(e){return e instanceof o?new o(this.x+e.x,this.y+e.y):new o(this.x+e,this.y+e)}sub(e){return e instanceof o?new o(this.x-e.x,this.y-e.y):new o(this.x-e,this.y-e)}negate(){return new o(-this.x,-this.y)}dot(e){return this.x*e.x+this.y*e.y}static lerp(e,s,i){return e.add(s.sub(e).mult(i))}}class T{pos;dim;borderRadius;constructor(e,s,i=1){this.pos=e,this.dim=s,this.borderRadius=i}getCenter(){return this.pos.add(this.dim.div(2))}render(e){e.fillStyle="F0EBE3",te(e,Math.floor(this.pos.x),Math.floor(this.pos.y),this.dim.x,this.dim.y,this.borderRadius+15)}}class P{pos;dim;onClick;text;color;borderRadius;constructor(e,s,i,n,l="red",a=55){this.pos=e,this.dim=s,this.text=i,this.onClick=n,this.color=l,this.borderRadius=a}getCenter(){return this.pos.add(this.dim.div(2))}isInside(e){return e.x>=this.pos.x&&e.x<=this.pos.x+this.dim.x&&e.y>=this.pos.y&&e.y<=this.pos.y+this.dim.y}checkClick(e){this.isInside(e)&&this.onClick(this)}render(e){e.fillStyle=this.color,te(e,Math.floor(this.pos.x),Math.floor(this.pos.y),this.dim.x,this.dim.y,this.borderRadius),e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.font=`${Math.floor(this.dim.y/3)}px "verdana", sans-serif`;const s=this.getCenter();e.fillText(this.text,s.x,s.y,this.dim.x)}}class L{pos;radius;velocity;sprite;rotSpeed;rot=0;player;bouncedOffWall=!1;constructor(e,s,i,n,l=0){this.pos=e,this.radius=s,this.velocity=i,this.sprite=n,this.rotSpeed=0,this.player=l}mass(){return Math.PI*this.radius*this.radius/100}kineticEnergy(){return this.mass()/2*this.velocity.squared()}outOfBounds(e,s){const i=this.radius+this.radius/3;return this.pos.x-this.radius+i<=0||this.pos.x+this.radius-i>=e||this.pos.y-this.radius+i<=0||this.pos.y+this.radius-i>=s}isCollidingBubble(e){const s=this.pos.sub(e.pos),i=this.radius+e.radius;return s.length()<=i}isCollidingBlock(e){const s=e.borderRadius;let i=!1;const n=Math.max(e.pos.x+s,Math.min(this.pos.x,e.pos.x+e.dim.x-s)),l=Math.max(e.pos.y+s,Math.min(this.pos.y,e.pos.y+e.dim.y-s)),a=new o(n,l),c=this.pos.sub(a).length();c<=this.radius&&(i=!0,n===e.pos.x+s||n===e.pos.x+e.dim.x-s||l===e.pos.y+s||e.pos.y+e.dim.y-s,this.radius-c);const b=[new o(e.pos.x+s,e.pos.y+s),new o(e.pos.x+e.dim.x-s,e.pos.y+s),new o(e.pos.x+s,e.pos.y+e.dim.y-s),new o(e.pos.x+e.dim.x-s,e.pos.y+e.dim.y-s)];for(const u of b){const p=this.pos.sub(u).length();if(p<=this.radius+s){i=!0,this.pos.sub(u).normalize(),this.radius+s-p;break}}return i}collideBlock(e){const s=e.borderRadius;let i=!1,n=new o(0,0),l=0;const a=Math.max(e.pos.x+s,Math.min(this.pos.x,e.pos.x+e.dim.x-s)),c=Math.max(e.pos.y+s,Math.min(this.pos.y,e.pos.y+e.dim.y-s)),b=new o(a,c),u=this.pos.sub(b).length();u<=this.radius&&(i=!0,a===e.pos.x+s?n=new o(-1,0):a===e.pos.x+e.dim.x-s?n=new o(1,0):c===e.pos.y+s?n=new o(0,-1):c===e.pos.y+e.dim.y-s&&(n=new o(0,1)),l=this.radius-u);const p=[new o(e.pos.x+s,e.pos.y+s),new o(e.pos.x+e.dim.x-s,e.pos.y+s),new o(e.pos.x+s,e.pos.y+e.dim.y-s),new o(e.pos.x+e.dim.x-s,e.pos.y+e.dim.y-s)];for(const h of p){const B=this.pos.sub(h).length();if(B<=this.radius+s){i=!0,n=this.pos.sub(h).normalize(),l=this.radius+s-B;break}}if(i){this.pos=this.pos.add(n.mult(l));const h=this.velocity.dot(n);this.velocity=this.velocity.sub(n.mult(2*h)),this.velocity=this.velocity.mult(ze),this.bouncedOffWall=!0}}collideBubble(e){const s=this.pos.sub(e.pos),i=this.radius+e.radius,n=s.length();if(n<=i){const l=s.normalize(),a=this.velocity.sub(e.velocity),c=l.mult(2*a.dot(l)/(this.mass()+e.mass()));this.velocity=this.velocity.sub(c.mult(e.mass())),e.velocity=e.velocity.add(c.mult(this.mass()));const b=i-n,u=l.mult(b/2);this.pos=this.pos.add(u),e.pos=e.pos.sub(u);const p=c.normalize().dot(new o(-this.velocity.y,this.velocity.x).normalize());this.rotSpeed=p/100,e.rotSpeed=p/100}}update(){this.velocity.y+=Re*this.mass(),this.velocity=this.velocity.mult(U),this.rotSpeed*=U,this.rot+=this.rotSpeed,this.pos=this.pos.add(this.velocity)}render(e){this.rot=this.rot||Math.PI*2*Math.random(),Le(e,this.sprite,this.pos,this.radius*2,this.rot)}simpleRender(e,s="rgb(200 0 0)"){e.fillStyle=s,F(e,this.pos,this.radius)}isInside(e){return e.sub(this.pos).length()<=this.radius}}function Le(t,e,s,i,n){t.save(),t.translate(Math.floor(s.x),Math.floor(s.y)),t.rotate(n),t.drawImage(e,-i/2,-i/2,i,i),t.restore()}function F(t,e,s){t.beginPath(),t.arc(Math.floor(e.x),Math.floor(e.y),s,0,Math.PI*2),t.fill()}function te(t,e,s,i,n,l){t.strokeStyle="rgba(0, 0, 0, 1.0)",t.lineWidth=6,t.beginPath(),t.moveTo(e+l,s),t.lineTo(e+i-l,s),t.arcTo(e+i,s,e+i,s+l,l),t.lineTo(e+i,s+n-l),t.arcTo(e+i,s+n,e+i-l,s+n,l),t.lineTo(e+l,s+n),t.arcTo(e,s+n,e,s+n-l,l),t.lineTo(e,s+l),t.arcTo(e,s,e+l,s,l),t.stroke(),t.fill()}const ke="/bubble_bounce/assets/abstract_dots-DTrwscDn.svg";class qe{canvas;callbacks;evCache=[];previousEvDistance=-1;constructor(e,s){this.canvas=e,this.callbacks=s,window.addEventListener("resize",this.callbacks.onResize),document.addEventListener("pointerdown",this.handlePointerDown.bind(this)),document.addEventListener("pointerup",this.handlePointerUp.bind(this)),document.addEventListener("pointermove",this.handlePointerMove.bind(this)),document.addEventListener("wheel",this.handleWheel.bind(this))}removeEvent(e){const s=this.evCache.findIndex(i=>i.pointerId===e.pointerId);this.evCache.splice(s,1)}convertEventPos(e){const s=this.canvas.getBoundingClientRect(),i=this.canvas.width/s.width,n=this.canvas.height/s.height;return new o((e.clientX-s.left)*i,(e.clientY-s.top)*n)}handlePointerMove(e){const s=this.convertEventPos(e);this.callbacks.onPointerMove(s);const i=this.evCache.findIndex(n=>n.pointerId===e.pointerId);if(this.evCache[i]=e,this.evCache.length===2){const n=new o(this.evCache[0].clientX,this.evCache[0].clientY),l=new o(this.evCache[1].clientX,this.evCache[1].clientY),a=n.sub(l).length(),c=13;this.previousEvDistance>0&&(a>this.previousEvDistance+c&&this.callbacks.onPinch("in"),a<this.previousEvDistance-c&&this.callbacks.onPinch("out")),this.previousEvDistance=a}}handlePointerDown(e){const s=this.convertEventPos(e);this.callbacks.onPointerDown(s),this.evCache.push(e)}handlePointerUp(e){const s=this.convertEventPos(e);this.callbacks.onPointerUp(s),this.removeEvent(e),this.evCache.length<2&&(this.previousEvDistance=-1)}handleWheel(e){this.callbacks.onScroll(e.deltaY)}}const We=Object.assign({"./assets/balls/1.png":oe,"./assets/balls/10.png":le,"./assets/balls/11.png":re,"./assets/balls/12.png":ae,"./assets/balls/16.png":he,"./assets/balls/17.png":ce,"./assets/balls/18.png":ue,"./assets/balls/19.png":de,"./assets/balls/2.png":be,"./assets/balls/20.png":pe,"./assets/balls/21.png":fe,"./assets/balls/22.png":ge,"./assets/balls/23.png":me,"./assets/balls/24.png":_e,"./assets/balls/25.png":we,"./assets/balls/26.png":ye,"./assets/balls/27.png":ve,"./assets/balls/28.png":Be,"./assets/balls/29.png":Ce,"./assets/balls/3.png":xe,"./assets/balls/30.png":Me,"./assets/balls/31.png":Pe,"./assets/balls/32.png":De,"./assets/balls/4.png":Se,"./assets/balls/5.png":Ee,"./assets/balls/6.png":Ie,"./assets/balls/7.png":Oe,"./assets/balls/8.png":Te}),E=Object.fromEntries(Object.entries(We).map(([t,e])=>{const s=t.match(/(\d+)\.png$/),i=s?s[1]:"1",n=new Image;return n.src=e,[i,n]})),r=document.getElementById("main-canvas");if(!r)throw new Error("Canvas not found");const R=r.getContext("2d");if(!R)throw new Error("2D context not found");const m=new OffscreenCanvas(r.width,r.height),f=m.getContext("2d",{alpha:!1});if(!f)throw new Error("2D context not found for offscreen canvas");let S=new o,d=[],w=[],y=[],k=[],se=0,v=0,N=0,I=Math.round(Math.random())+1,j=!1,x=!0,D=!1;const C=[0,3,5,8,10,15];let M=C[2];const z=75,je=50,X=37,$=300,q=500;let g=[],Y=-1;const $e=18,W=new Image;W.src=ke;let _=null;const Ae=t=>{for(const e of w)if(t.isCollidingBlock(e))return!0;for(const e of d)if(t.isCollidingBubble(e))return!0;return!1};function O(t){return Object.values(E)[t]||E[1]}function H(){return Math.floor(Math.random()*Object.keys(E).length)}function Xe(){const t=new o(600,200),e=40,s="#92D8F8",i="#363858",n=new o(700,250);y.push(new P(new o((r.width-n.x)/2,r.height-n.y-100),n,"START",h=>{ie(),v=1},"pink")),y.push(new P(new o((r.width-t.x)/2,r.height-t.y*1-400),t,x?"Blocks: Enabled":"Blocks: Disabled",h=>{x=!x,h.text=x?"Blocks: Enabled":"Blocks: Disabled",h.color=x?s:i},x?s:i)),y.push(new P(new o((r.width-t.x)/2,r.height-t.y*2-400-e*1),t,D?"Require bounce: Enabled":"Require bounce: Disabled",h=>{D=!D,h.text=D?"Require bounce: Enabled":"Require bounce: Disabled",h.color=D?s:i},D?s:i));const a=`rgb(${-(M/C[C.length-1])*100+200}, 233, 203)`;y.push(new P(new o((r.width-t.x)/2,r.height-t.y*3-400-e*2),t,`Small balls: ${M}`,h=>{const B=C.indexOf(M);M=C[(B+1)%C.length];const A=M/C[C.length-1];h.color=`rgb(${-A*100+200}, 233, 203)`,h.text=`Small balls: ${M}`},a));const c=new o(r.width/2,350),b=new o(80,z*2),u="#dbedd0",p=200;if(g.length===0){g[0]=H();do g[1]=H();while(g[0]===g[1])}for(let h=0;h<=1;h++){const B=h*2-1;k.push(new L(c.add(new o(B*p,0)),z,new o,O(g[h]),h+1)),y.push(new P(c.add(new o(B*p-z-b.x,-b.y/2)),b,"<",A=>{g[h]=(g[h]-1)%Object.keys(E).length,g[h]<0&&(g[h]=Object.keys(E).length-1),k[h].sprite=O(g[h])},u,20)),y.push(new P(c.add(new o(B*p+z,-b.y/2)),b,">",A=>{g[h]=(g[h]+1)%Object.keys(E).length,k[h].sprite=O(g[h])},u,20))}}function Fe(){const t=new o(30,700),e=t.x/5,s=new o(r.width-e-t.x,(r.height-t.y)/2);if(w.push(new T(new o(e,(r.height-t.y)/2),t.mult(1))),w.push(new T(s,t.mult(1))),x){const i=Math.round(Math.random())+1;if(i===1){const n=230+170*Math.random(),l=new o(e+t.x+Math.random()*(r.width-n-2*(e+t.x)),(r.height-t.x)/2);w.push(new T(l,new o(n,t.x)))}else if(i===2){const n=170+80*Math.random(),l=100+50*Math.random(),a=new o(e+t.x+Math.random()*(r.width-n-l-2*(e+t.x)),(r.height-t.x)/2),c=new o(a.x+n+Math.random()*(r.width-n-l-a.x-e-t.x),(r.height-t.x)/2);w.push(new T(a,new o(n,t.x))),w.push(new T(c,new o(l,t.x)))}}}W.onload=t=>{G()};function G(){m.width=r.width,m.height=r.height,f.clearRect(0,0,m.width,m.height),f.fillStyle="#efe1e1",f.fillRect(0,0,m.width,m.height),f.save(),f.filter="drop-shadow(4px 4px 5px black) brightness(0.1) opacity(10%)",f.scale(2,2),f.drawImage(W,0,0,W.width,W.height),f.restore(),x&&v!==2&&(f.lineWidth=3,f.strokeStyle="rgba(0, 0, 0, 0.4)",f.beginPath(),f.moveTo(m.width/10,m.height/2),f.lineTo(9*m.width/10,m.height/2),f.stroke());for(const t of w)t.render(f)}function K(t,e,s,i){const n=+i*2-1,l=new L(t,z,new o,e,s);d.push(l);for(let u=0;u<=5;u++)d.push(new L(new o(u/5*r.width,t.y+$/2*n),je,new o,e,s));const a=150;let c=0,b=0;for(;c<M&&b<=a;){const u=new L(new o(X+Math.random()*(r.width-X*2),t.y-$/2*n*Math.random()),X,new o,e,s);Ae(u)||(c++,d.push(u)),b++}b>=a&&console.error("couldn't spawn all small bubbles :(")}function ne(){Z(),Fe(),Xe();const t=new o(r.width/2,$),e=new o(r.width/2,r.height-$);K(t,O(g[0]),1,!0),K(e,O(g[1]),2,!1);const s={onPointerMove:i=>{S=i},onPointerDown:i=>{if(S=i,v===0){for(const n of y)n.checkClick(i);return}if(v===2){ie();return}j||(_=Qe(S),_&&_.player!==I&&(_=null))},onPointerUp(i){if(_){const n=_.pos.sub(S).mult(Y);_.velocity=n.normalize().mult(Math.min(n.length(),q)/q*$e),_=null,Ne(),j=!0}},onScroll(i){i<0?V():ee()},onPinch:i=>{i==="in"?V():i==="out"&&ee()},onResize:()=>{Z()}};new qe(r,s)}function ie(){v=0,d=[],w=[],y=[],k=[],I=Math.round(Math.random())+1,ne(),G()}function Z(){r.height=1600,r.width=950}function J(t){v=2,w=[],G(),N=t}function Ne(){I===1?I=2:I=1}const Ye=()=>{for(const t of d)if(t.velocity.length()>.24)return!1;return!0},Ge=()=>{let t=!1,e=!1;for(const s of d)if(s.player===1?t=!0:e=!0,t&&e)break;return t&&e?0:t?2:1};function Q(){d.forEach((t,e)=>{t.update();for(const s of d.slice(e+1))t.collideBubble(s);for(const s of w)t.collideBlock(s)})}function Ue(t){if(se=t,d=d.filter(e=>!e.outOfBounds(r.width,r.height)),Q(),Ye()&&j){for(let e=0;e<1e3;e++)Q();if(j=!1,d.length===0)J(0);else{const e=Ge();e!==0&&J(e)}}}function He(t){t.clearRect(0,0,r.width,r.height),t.drawImage(m,0,0);{t.lineWidth=2;for(let s=1;s<=2;s++){const i=d.filter(n=>n.player===s);t.beginPath(),t.strokeStyle=`rgba(0, 0, 0, ${.2})`,i.forEach((n,l)=>{for(const a of i.slice(l+1))n.pos.sub(a.pos).length()<=300&&(t.moveTo(Math.floor(n.pos.x),Math.floor(n.pos.y)),t.lineTo(Math.floor(a.pos.x),Math.floor(a.pos.y)))}),t.stroke()}}for(const e of d)e.player===I&&!j&&(t.fillStyle="rgba(0,0,0,0.3)",F(t,e.pos,e.radius+e.radius*.15*(Math.sin(se/250)+1))),e.render(t);if(_){const e=_.pos,s=new o(r.width,r.height).length(),i=e.add(e.sub(S).mult(Y).normalize().mult(s)),n=Je(e,i,_.radius,_,200);n&&(t.fillStyle=_.player===2?"rgba(158, 152, 250, 0.3)":"rgba(250, 163, 152, 0.3)",F(t,n,_.radius));let l=e.sub(S);t.strokeStyle="rgb(0 0 0)",l.length()>q&&(l=l.normalize().mult(q),t.strokeStyle="rgb(120 0 0)");const a=l.length()/q;let c=e.add(l.mult(Y));t.beginPath(),t.setLineDash([5+5*a,17*a]),t.lineWidth=6,t.moveTo(e.x,e.y),t.lineTo(c.x,c.y),t.stroke(),t.setLineDash([])}}function Ke(t){t.clearRect(0,0,r.width,r.height),t.drawImage(m,0,0);let e="";N===0?e="Draw":N===1?e="Player 1 won!":e="Player 2 won!",t.fillStyle="black",t.textAlign="center",t.font='bold 120px "verdana", sans-serif',t.fillText(e,r.width/2,r.height/2),t.font='60px "verdana", sans-serif',t.fillText("Click to continue...",r.width/2,r.height*2/3)}function Ze(t){t.clearRect(0,0,r.width,r.height),t.drawImage(m,0,0);for(const e of y)e.render(t);for(const e of k)e.render(t);t.fillStyle="black",t.textAlign="center",t.font='bold 100px "Helvetica", sans-serif',t.fillText("Bubble Bounce",r.width/2,r.height/8)}function Je(t,e,s,i,n=100){const l=e.sub(t),a=new L(new o,s,new o,O(1));for(let c=1;c<=n;c++){const b=c/n,u=t.add(l.mult(b));a.pos=u;for(let p=0;p<d.length;p++){const h=d[p];if(h!==i&&a.isCollidingBubble(h))return a.pos.mult(1)}for(const p of w)if(a.isCollidingBlock(p))return a.pos.mult(1)}return null}function Qe(t){for(let e=0;e<d.length;e++){const s=d[e];if(s.isInside(t))return s}return null}const V=()=>{r.style.transform="scale(1)"},ee=()=>{r.style.transform="scale(0.8)"};ne();(()=>{function t(e){if(window.requestAnimationFrame(t),!R)throw new Error("Main loop: 2D context not found");v===0?Ze(R):v===1?(Ue(e),He(R)):v===2&&Ke(R)}t(0)})();
